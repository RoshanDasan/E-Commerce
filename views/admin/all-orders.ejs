<head>
    
  <style>

    table.dataTable thead .sorting:after,
    table.dataTable thead .sorting:before,
    table.dataTable thead .sorting_asc:after,
    table.dataTable thead .sorting_asc:before,
    table.dataTable thead .sorting_asc_disabled:after,
    table.dataTable thead .sorting_asc_disabled:before,
    table.dataTable thead .sorting_desc:after,
    table.dataTable thead .sorting_desc:before,
    table.dataTable thead .sorting_desc_disabled:after,
    table.dataTable thead .sorting_desc_disabled:before {
      bottom: .5em;
    }
      </style>
</head>

<table id="dtOrderExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
    <thead>
      <tr>
        <th class="th-sm">Name
        </th>
        <th class="th-sm">Position
        </th>
        <th class="th-sm">Office
        </th>
        <th class="th-sm">Age
        </th>
        <th class="th-sm">Start date
        </th>
        <th class="th-sm">Salary
        </th>
        <th class="th-sm">.
        </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <% response.forEach(function(user) { %>

        <td><%=user.orders.shippingAddress.fname%></td>
        <td><%=user._id%></td>
        <td><%=user.orders.paymentStatus%></td>
        <td><%=user.orders.shippingAddress.mobile%></td>
        <td><%=user.orders.createdAt%></td>


        <%if(user.orders.orderConfirm == 'cancelled'){%>
          <td> <p style="color: red;">canceled</p></td>
          <td></td>
     
           <%}else {%>
            <td><%=user.orders.orderConfirm%></td>
        <td><div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
           Change order status
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            
           <button onclick="orderStatus('<%=user.orders._id%>','order-placed')">Order placed</button>
           <button onclick="orderStatus('<%=user.orders._id%>','order-dispatched')">Order Dispatched</button>
           <button onclick="orderStatus('<%=user.orders._id%>','out-for-delivery')">Out for Delivery</button>
           <button onclick="orderStatus('<%=user.orders._id%>','delivered')">Delivered</button>
           <button onclick="orderStatus('<%=user.orders._id%>','cancelled')">Cancel</button>
           
          </div>
        </div></td>
           
          <%}%>

        



      </tr>

      <% }) %>

     
    </tbody>
   
  </table>





<script>


function orderStatus(orderId, status)
{
  console.log(orderId, status);
  $.ajax({
    url:'/admin/orderStatus',
    method:'put',
    data: {
      orderId: orderId,
      status: status
    },
    success:(response)=>
    {
      if(response.update)
      {
        location.reload()
      }
    }
  })
}


// $(document).ready(function () {
//   $('#dtOrderExample').DataTable({
//     "order": [[ 3, "desc" ]]
//   });
//     $('.dataTables_length').addClass('bs-select');
// });

</script>